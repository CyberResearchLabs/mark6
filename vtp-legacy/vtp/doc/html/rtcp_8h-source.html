<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>vtp: rtcp.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.3 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Compound&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Compound&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>rtcp.h</h1><a href="rtcp_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * $Source: /usr/local/cvsroot/mit/vtp/doc/html/rtcp_8h-source.html,v $</span>
00003 <span class="comment"> * $Revision: 1.1 $</span>
00004 <span class="comment"> * $Date: 2003/09/09 18:03:37 $</span>
00005 <span class="comment"> * $State: Exp $</span>
00006 <span class="comment"> * $Author: davidlapsley $</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * $Log: rtcp_8h-source.html,v $
00008 <span class="comment"> * Revision 1.1  2003/09/09 18:03:37  davidlapsley
00008 <span class="comment"> * *** empty log message ***
00008 <span class="comment"> *</span>
00009 <span class="comment"> * Revision 1.5  2003/09/09 05:57:42  davidlapsley</span>
00010 <span class="comment"> * - Removed members and senders from rtcp_member_t (this logic already</span>
00011 <span class="comment"> * maintained in OnReceive).</span>
00012 <span class="comment"> * - Completed rtcp_send_report(), rtcp_send_bye() functions.</span>
00013 <span class="comment"> * - Made buffer sizes in rtcp_session_t an initialization parameter.</span>
00014 <span class="comment"> * - client.c: integrating rtcp module</span>
00015 <span class="comment"> *</span>
00016 <span class="comment"> * Revision 1.4  2003/09/08 21:54:27  davidlapsley</span>
00017 <span class="comment"> * - Added random module for generating random 32 bit integers.</span>
00018 <span class="comment"> * - Replaced u_intXX style typedefs with standard u_intXX_t types.</span>
00019 <span class="comment"> * - Added variables to rtcp_t session member.</span>
00020 <span class="comment"> * - Added code file template: template.h which includes the MIT license</span>
00021 <span class="comment"> * header.</span>
00022 <span class="comment"> *</span>
00023 <span class="comment"> * Revision 1.3  2003/09/04 22:07:52  davidlapsley</span>
00024 <span class="comment"> * Added new module: members to encapsulate the member tree. The member</span>
00025 <span class="comment"> * tree consists of a struct: members_t that encapsulates a glib balances</span>
00026 <span class="comment"> * tree. This tree is used to store a list of session members and their</span>
00027 <span class="comment"> * state.</span>
00028 <span class="comment"> *</span>
00029 <span class="comment"> * Revision 1.2  2003/09/04 12:39:40  davidlapsley</span>
00030 <span class="comment"> * Daily release.</span>
00031 <span class="comment"> *</span>
00032 <span class="comment"> * Revision 1.1  2003/09/03 19:57:23  davidlapsley</span>
00033 <span class="comment"> * Added new rtcp module that implements the RTCP session functionality.</span>
00034 <span class="comment"> * All RTCP state is stored in this module and state management functions</span>
00035 <span class="comment"> * are also implemented in this module.</span>
00036 <span class="comment"> *</span>
00037 <span class="comment"> * RTP module is now mainly for defining RTP/RTCP data types (e.g. packet</span>
00038 <span class="comment"> * formats etc.). Most functinality has moved into rtcp module.</span>
00039 <span class="comment"> *</span>
00040 <span class="comment"> * Currently code compiles but does not link. Need to implement module (interfaces</span>
00041 <span class="comment"> * have been done).</span>
00042 <span class="comment"> *</span>
00043 <span class="comment"> *</span>
00044 <span class="comment"> *</span>
00045 <span class="comment"> *</span>
00046 <span class="comment"> */</span>
00047 
00048 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
00049 <span class="preprocessor">#include &lt;glib.h&gt;</span>
00050 <span class="preprocessor">#include &lt;<a class="code" href="rtp_8h.html">rtp.h</a>&gt;</span>
00051 <span class="preprocessor">#include &lt;<a class="code" href="schedule_8h.html">schedule.h</a>&gt;</span>
00052 <span class="preprocessor">#include &lt;<a class="code" href="members_8h.html">members.h</a>&gt;</span>
00053 
00054 <span class="preprocessor">#ifndef _RTCP_H_</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#define _RTCP_H_</span>
00056 <span class="preprocessor"></span>
<a name="l00060"></a><a class="code" href="structrtcp__session__t.html">00060</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00061     <span class="comment">/* Stores member state */</span>
<a name="l00062"></a><a class="code" href="structrtcp__session__t.html#o0">00062</a>     <a class="code" href="structmembers__t.html">members_t</a>* member_tree;
00063 
00064     <span class="comment">/* For storing socket descriptors */</span>
<a name="l00065"></a><a class="code" href="structrtcp__session__t.html#o1">00065</a>     <span class="keywordtype">int</span> ctrl_sock;
<a name="l00066"></a><a class="code" href="structrtcp__session__t.html#o2">00066</a>     <span class="keywordtype">int</span> data_sock;
00067 
00068     <span class="comment">/* For calcuation of rtcp_interval */</span>
<a name="l00069"></a><a class="code" href="structrtcp__session__t.html#o3">00069</a>     <span class="keywordtype">int</span> members;
<a name="l00070"></a><a class="code" href="structrtcp__session__t.html#o4">00070</a>     <span class="keywordtype">int</span> senders;
<a name="l00071"></a><a class="code" href="structrtcp__session__t.html#o5">00071</a>     <span class="keywordtype">int</span> pmembers;
<a name="l00072"></a><a class="code" href="structrtcp__session__t.html#o6">00072</a>     <span class="keywordtype">double</span> rtcp_bw;
<a name="l00073"></a><a class="code" href="structrtcp__session__t.html#o7">00073</a>     <span class="keywordtype">double</span> avg_rtcp_size;
00074 
00075     <span class="comment">/* Flags */</span>
<a name="l00076"></a><a class="code" href="structrtcp__session__t.html#o8">00076</a>     <span class="keywordtype">int</span> we_sent;
<a name="l00077"></a><a class="code" href="structrtcp__session__t.html#o9">00077</a>     <span class="keywordtype">int</span> initial;
00078 
00079     <span class="comment">/* Next event to occur */</span>
<a name="l00080"></a><a class="code" href="structrtcp__session__t.html#o10">00080</a>     <a class="code" href="structrtcp__event__t.html">rtcp_event_t</a> curr_event;
00081 
00082     <span class="comment">/* Time parameters */</span>
<a name="l00083"></a><a class="code" href="structrtcp__session__t.html#o11">00083</a>     <span class="keywordtype">double</span> tc;
<a name="l00084"></a><a class="code" href="structrtcp__session__t.html#o12">00084</a>     <span class="keywordtype">double</span> tp;
<a name="l00085"></a><a class="code" href="structrtcp__session__t.html#o13">00085</a>     <a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a> *p;
<a name="l00086"></a><a class="code" href="structrtcp__session__t.html#o14">00086</a>     <span class="keyword">struct </span>timeval t0;
<a name="l00087"></a><a class="code" href="structrtcp__session__t.html#o15">00087</a>     <span class="keywordtype">double</span> tn;
<a name="l00088"></a><a class="code" href="structrtcp__session__t.html#o16">00088</a>     u_int32_t rtp_ts0;
<a name="l00089"></a><a class="code" href="structrtcp__session__t.html#o17">00089</a>     u_int32_t ntp_sec0;
<a name="l00090"></a><a class="code" href="structrtcp__session__t.html#o18">00090</a>     u_int32_t ntp_frac0;
<a name="l00091"></a><a class="code" href="structrtcp__session__t.html#o19">00091</a>     u_int32_t sampling_frequency;
<a name="l00092"></a><a class="code" href="structrtcp__session__t.html#o20">00092</a>     u_int32_t samples_per_packet;
<a name="l00093"></a><a class="code" href="structrtcp__session__t.html#o21">00093</a>     u_int32_t bits_per_sample;
00094 
00095     <span class="comment">/* Sender report stats */</span>
<a name="l00096"></a><a class="code" href="structrtcp__session__t.html#o22">00096</a>     u_int32_t psent;
<a name="l00097"></a><a class="code" href="structrtcp__session__t.html#o23">00097</a>     u_int32_t osent;
00098 
00099     <span class="comment">/* Stores event queue */</span>
<a name="l00100"></a><a class="code" href="structrtcp__session__t.html#o24">00100</a>     <a class="code" href="structschedule__t.html">schedule_t</a>* evt_sched;
00101 
00102     <span class="comment">/* Control buffers */</span>
<a name="l00103"></a><a class="code" href="structrtcp__session__t.html#o25">00103</a>     u_int8_t *ctrl_rcv_buf;
<a name="l00104"></a><a class="code" href="structrtcp__session__t.html#o26">00104</a>     u_int8_t *ctrl_snd_buf;
00105 
<a name="l00106"></a><a class="code" href="structrtcp__session__t.html#o27">00106</a>     u_int32_t ssrc;
00107 } <a class="code" href="structrtcp__session__t.html">rtcp_session_t</a>;
00108 
00109 <span class="comment">/* Session initiation/termination */</span>
00110 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8c.html#a0">rtcp_init</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a>* s,
00111                      <span class="keywordtype">double</span> rtcp_bw,
00112                      <span class="keywordtype">double</span> avg_rtcp_size,
00113                      u_int32_t ssrc,
00114                      u_int32_t sampling_frequency,
00115                      u_int32_t samples_per_packet,
00116                      u_int32_t bits_per_sample,
00117                      u_int32_t sz_ctrl_rcv_buf,
00118                      u_int32_t sz_ctrl_snd_buf);
00119 
00120 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8c.html#a1">rtcp_destroy</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a>* s);
00121 
00122 <span class="comment">/* Packet transmission */</span>
00123 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8c.html#a2">rtcp_send_rtcp_report</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s, <a class="code" href="structrtcp__event__t.html">rtcp_event_t</a> e);
00124 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8c.html#a3">rtcp_send_bye_packet</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s, <a class="code" href="structrtcp__event__t.html">rtcp_event_t</a> e);
00125 
00126 <span class="comment">/* Search functions */</span>
00127 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8c.html#a4">rtcp_new_member</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s, <a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a>* p);
00128 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8c.html#a5">rtcp_new_sender</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s, <a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a>* p);
00129 
00130 <span class="comment">/* Session state */</span>
00131 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8c.html#a6">rtcp_add_member</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s, <a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a>* p);
00132 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8c.html#a7">rtcp_remove_member</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s, <a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a>* p);
00133 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8c.html#a8">rtcp_add_sender</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s, <a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a>* p);
00134 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8c.html#a9">rtcp_remove_sender</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s, <a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a>* p);
00135 <span class="keyword">static</span> <a class="code" href="structrtcp__member__t.html">rtcp_member_t</a>* <a class="code" href="rtcp_8h.html#a10">rtcp_get_sender</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s, <span class="keyword">const</span> u_int32_t* ssrc);
00136 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rtcp_8h.html#a11">init_seq</a>(<a class="code" href="structsource.html">source</a> *s, u_int16_t seq);
00137 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8h.html#a12">update_seq</a>(<a class="code" href="structsource.html">source</a> *s, u_int16_t seq);
00138 
00139 
00140 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="rtcp_8c.html#a11">rtcp_on_receive</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s,
00141                             <a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a> *p);
00142 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="rtcp_8c.html#a12">rtcp_on_expire</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> * s);
00143 
00144 
00145 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rtcp_8h.html#a15">on_receive</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s,
00146                        <a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a> *p,
00147                        <a class="code" href="structrtcp__event__t.html">rtcp_event_t</a> e,
00148                        <span class="keywordtype">int</span> *members,
00149                        <span class="keywordtype">int</span> *pmembers,
00150                        <span class="keywordtype">int</span> *senders,
00151                        <span class="keywordtype">double</span> *avg_rtcp_size,
00152                        <span class="keywordtype">double</span> *tp,
00153                        <span class="keywordtype">double</span> tc,
00154                        <span class="keywordtype">double</span> tn);
00155 
00156 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rtcp_8h.html#a16">on_expire</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s,
00157                       <a class="code" href="structrtcp__event__t.html">rtcp_event_t</a> e,
00158                       <span class="keywordtype">int</span> members,
00159                       <span class="keywordtype">int</span> senders,
00160                       <span class="keywordtype">double</span> rtcp_bw,
00161                       <span class="keywordtype">int</span> we_sent,
00162                       <span class="keywordtype">double</span>* avg_rtcp_size,
00163                       <span class="keywordtype">int</span> *intial,
00164                       <span class="keywordtype">double</span> tc,
00165                       <span class="keywordtype">double</span> *tp,
00166                       <span class="keywordtype">int</span> *pmembers);
00167 
00168 <span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="rtcp_8h.html#a17">rtcp_interval</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s,
00169                             <span class="keywordtype">int</span> members,
00170                             <span class="keywordtype">int</span> senders,
00171                             <span class="keywordtype">double</span> rtcp_bw,
00172                             <span class="keywordtype">int</span> we_sent,
00173                             <span class="keywordtype">double</span> avg_rtcp_size,
00174                             <span class="keywordtype">int</span> initial);
00175 
00176 <span class="comment">/* Scheduling */</span>
00177 
00185 <span class="keyword">extern</span> gpointer <a class="code" href="rtcp_8c.html#a21">rtcp_earliest_event</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s, gpointer t);
00186 
00187 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rtcp_8h.html#a19">rtcp_schedule</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s,
00188                           <span class="keywordtype">double</span> t,
00189                           <a class="code" href="structrtcp__event__t.html">rtcp_event_t</a> e);
00190 
00191 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="rtcp_8h.html#a20">rtcp_reschedule</a>(<a class="code" href="structrtcp__session__t.html">rtcp_session_t</a> *s,
00192                             <span class="keywordtype">double</span> t,
00193                             <a class="code" href="structrtcp__event__t.html">rtcp_event_t</a> e);
00194 
00195 
00196 <span class="comment">/* Misc */</span>
00197 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8h.html#a21">rtcp_received_packet_size</a>(<a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a> *p);
00198 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="rtcp_8h.html#a22">rtcp_sent_packet_size</a>(<a class="code" href="structrtcp__event__t.html">rtcp_event_t</a> e);
00199 <span class="keyword">static</span> <a class="code" href="rtp_8h.html#a34">rtcp_event_type_t</a> <a class="code" href="rtcp_8h.html#a23">rtcp_type_of_event</a>(<a class="code" href="structrtcp__event__t.html">rtcp_event_t</a> e);
00200 <span class="keyword">static</span> <a class="code" href="rtp_8h.html#a35">rtcp_packet_type_t</a> <a class="code" href="rtcp_8c.html#a24">rtcp_packet_type</a>(<a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a> *p);
00201 <span class="keyword">static</span> u_int32_t <a class="code" href="rtcp_8h.html#a25">rtcp_packet_ssrc</a>(<a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a> *p);
00202 <span class="keyword">static</span> u_int32_t <a class="code" href="rtcp_8h.html#a26">rtcp_packet_seq</a>(<a class="code" href="structrtcp__packet__t.html">rtcp_packet_t</a> *p);
00203 
00204 
00205 
00206 <span class="preprocessor">#endif</span>
00207 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Sep 9 13:24:39 2003 for vtp by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.3 </small></address>
</body>
</html>
