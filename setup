#!/bin/bash

# Date:	6/21/2011
# Description:
#	Install build dependencies.

MARK6_ROOT=/home/dlapsley/mark6
EXTERN_ROOT=${MARK6_ROOT}/src/extern

INSTALL=/usr/bin/apt-get
TAR=/bin/tar

# PREQ="boost141-devel.x86_64 cppunit-devel.x86_64 texinfo.x86_64 texi2html.noarch texinfo-tex.x86_64 apr-devel.x86_64 apr-util-devel.x86_64"
PREQ="libboost-all-dev libcppunit-dev texinfo texi2html libapr1-dev libaprutil1-dev liblog4cxx10-dev automake autoconf build-essential"
APR=apr-1.4.5
APR_UTIL=apr-util-1.3.12
LOG4CXX=apache-log4cxx-0.10.0
PF_RING=PF_RING-4.7.0

install_binary_deps() {
	echo Installing binary dependencies: ${PREQ}
	sudo ${INSTALL} install ${PREQ} -y
}

install_source_deps() {
	echo Installing ${APR}...

	cd ${EXTERN_ROOT}
	${TAR} xvzf ${APR}.tar.gz
	cd ${APR}
	./configure --prefix=/usr/local \
		--enable-threads
	make
	sudo make install
	cd ..

	# See: http://www.bmplab.com/archives/22
	echo Installing ${APR_UTIL}...
	cd ${EXTERN_ROOT}
	${TAR} xvzf ${APR_UTIL}.tar.gz
	cd ${APR_UTIL}
	./configure --prefix=/usr/local \
		--with-expat='builtin' \ 
		--with-apr=/usr/local
	make
	sudo make install
	cd ..


	echo Installing ${LOG4CXX}...
	cd ${EXTERN_ROOT}
	${TAR} xvzf ${LOG4CXX}.tar.gz
	cd ${LOG4CXX}


	./configure --prefix=/usr/local \
		--with-apr=/usr/local \
		--with-apr-util=/usr/local  
	make
	sudo make install
	cd ..
}

install_pf_ring() {
	echo Installing ${PF_RING}...
	cd ${EXTERN_ROOT}
	${TAR} xvzf ${PF_RING}.tar.gz
	cd ${PF_RING}

	cd kernel
	make
	cd ..

	cd userland
	make
	cd ..

	/bin/ln -s ${PF_RING} pf_ring

	cd ..
}

build() {
	./bootstrap
	./configure \
		--prefix=/opt/haystack \
		BOOST_INCDIR=/usr/include/boost \
		BOOST_LIBDIR=/usr/lib64/boost
make
}

install_binary_deps
# install_source_deps
# install_pf_ring
build

